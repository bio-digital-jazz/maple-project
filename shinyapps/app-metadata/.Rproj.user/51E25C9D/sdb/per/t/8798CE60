{
    "collab_server" : "",
    "contents" : "library(RSQLite)\nlibrary(dplyr)\nlibrary(readr)\n\ncon <- dbConnect(SQLite(), \"../../projects/DjangoProjects/data_manager/db.sqlite3\")\n\n\ndataAssetsDF0 <- as_tibble(dbGetQuery(con, \"SELECT * FROM data_assets_dataasset\"))\nusersDF0 <- as_tibble(dbGetQuery(con, \"SELECT * FROM auth_user\"))\ndataAssetRolesDF0<- as_tibble(dbGetQuery(con, \"SELECT * FROM data_assets_dataassetrole\"))\n\nrelatedResourcesDF0 <- as_tibble(dbGetQuery(con, \"SELECT * FROM related_resources_dataassetrelatedresource\"))\ndataAssetRelatedResourcesDF0 <- as_tibble(dbGetQuery(con, \"SELECT * FROM related_resources_dataassetrelatedresource_data_asset\"))\n\n\n\n# Create assets\n\ndataAssetsDF1 <- dataAssetsDF0 %>%\n  mutate(currently_active = case_when(\n    currently_active == 0 ~ \"No\",\n    currently_active == 1 ~ \"Yes\"\n  )) %>%\n  mutate(used_in_shared_dictionary = case_when(\n    used_in_shared_dictionary == 0 ~ \"No\",\n    used_in_shared_dictionary == 1 ~ \"Yes\"\n  )) %>%\n  mutate(governed_as_external_data = case_when(\n    governed_as_external_data == 0 ~ \"No\",\n    governed_as_external_data == 1 ~ \"Yes\"\n  )) %>%\n  mutate(available_for_analytics = case_when(\n    available_for_analytics == 0 ~ \"No\",\n    available_for_analytics == 1 ~ \"Yes\"\n  )) %>%\n  mutate(under_review = case_when (\n    under_review == 0 ~ \"No\",\n    under_review == 1 ~ \"Yes\"\n  )) %>%\n  mutate(utlizes_external_data = case_when(\n    utlizes_external_data == 0 ~\"No\",\n    utlizes_external_data == 1 ~ \"Yes\"\n  ))\n\n  \n\n\n\nglimpse(dataAssetsDF1)\n\ndataAssetsDF0$name\n\n\ncolnames(dataAssetsDF1) <- c('dataAssetID',\n                             'Owning organisation',\n                             'Owning business unit',\n                             'Name',\n                             'Asset ID',\n                             'Version',\n                             'Emergency shutdown contact',\n                             'Emergency shutdown organisation',\n                             'Coverage start date',\n                             'Coverage end date',\n                             'Data limiting marker',\n                             'Update frequency',\n                             'Currently active',\n                             'Used in shared dictionary',\n                             'Governed as external data',\n                             'Available for analytics',\n                             'Usage notes available',\n                             'Data location',\n                             'Description',\n                             'Data location type',\n                             'Under review',\n                             'Utilizes external data',\n                             'Type'\n                             )\n\n\n\n\n\nreadr::write_csv(dataAssetsDF1, \"./data/preparedData/dataAssets.csv\")\n\n# Create users and roles\nusersAndRolesDF0 = usersDF0 %>%\n  left_join(dataAssetRolesDF0, by = c(\"id\" = \"user_id\" )) %>%\n  select(type, \n         first_name, \n         last_name, \n         start_date, \n         end_date,\n         status,\n         data_asset_id)\n\n\n\ncolnames(usersAndRolesDF0) <- c(\"Type\", \n                                \"First name\",\n                                \"Last name\",\n                                \"Start date\",\n                                \"End date\",\n                                \"Status\",\n                                \"dataAssetID\")\n\nreadr::write_csv(usersAndRolesDF0, \"./data/preparedData/usersAndRoles.csv\")\n\n\n# Create assets and resources\n\nassetsAndResourcesDF0 =  inner_join(relatedResourcesDF0, \n                                    dataAssetRelatedResourcesDF0,  \n                                    by = c(\"id\" = \"dataassetrelatedresource_id\"))\nassetsAndResourcesDF0 %>%\n    select(dataasset_id,\n           title,\n           description,\n           date_created,\n           next_review_date,\n           version,\n           hprm_reference) -> assetsAndResourcesDF1\n\ncolnames(assetsAndResourcesDF1) = c('dataAssetID',\n                                    'Title',\n                                    'Description',\n                                    'Date created',\n                                    'Next review date',\n                                    'Version',\n                                    'Reference')\n\n\n\n\n\nreadr::write_csv(assetsAndResourcesDF1, \"./data/preparedData/assetsAndResources.csv\")\n\n# Create Metadata Table\n\n\n",
    "created" : 1538030688947.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3740377621",
    "id" : "8798CE60",
    "lastKnownWriteTime" : 1538714090,
    "last_content_update" : 1538714090003,
    "path" : "C:/JamiesFiles/Projects/MapleProject/shinyapps/app-metadata/data/dataPrep.R",
    "project_path" : "data/dataPrep.R",
    "properties" : {
        "source_window_id" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}