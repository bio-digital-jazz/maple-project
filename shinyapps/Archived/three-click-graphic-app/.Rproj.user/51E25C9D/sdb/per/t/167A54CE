{
    "collab_server" : "",
    "contents" : "#Removing all objects in memory\nrm(list=setdiff(ls(), \"x\"))\n\n#Loading packages\nlibrary(shiny)\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(data.table)\nlibrary(DT)\nlibrary(readr)\nlibrary(shinythemes)\nlibrary(scales)\nlibrary(ggbeeswarm)\nlibrary(networkD3)\nlibrary(lubridate)\nlibrary(plotly)\nlibrary(Cairo)\noptions(shiny.usecairo=T)\n\n\n### Constants - colours from RBCO chart\nkColPurple = \"#48156BBF\"\nkBarCols = c(\n  rgb( 74/256,  37/256, 116/256),\n  rgb(168/256, 143/256, 190/256),\n  rgb(128/256,  39/256, 122/256),\n  rgb(206/256, 178/256, 205/256),\n  rgb(  9/256, 168/256, 224/256),\n  rgb(  0/256,  86/256, 161/256),\n  rgb(134/256, 151/256, 204/256))\n  \n\n### Import & Tidy & Transform\n## Fun plot\n# grab some data\nImage1 = png::readPNG(\"Drugs2.png\")\n# Image1 = jpeg::readJPEG(\"Drugs3.jpg\")\n\nRast1  = grid::rasterGrob(Image1, interpolate = T, height = 1, width = 1)\nLine = data.frame(Year = 2009:2019,\n                  Spend = 6:16 + rnorm(11))\nPoly = rbind(c(0,0), Line, c(2020, 100), c(0,100))\n\n\n\n\n\n###Building Shiny App\n\n##1. Shiny UI ns\n#Setting ui as a fluidPage: FluidPage enables Shiny Apps to adjust to screens of varying resolution\nui <- fluidPage(title=\"Infographic\", column(12,offset = 0,\n                #CSS styling\n                tags$style(HTML(\"\n                                .tabbable > .nav > li > a {background-color: rgb(255,255,255);  color:black}\n                                .nav-tabs>li>a {border: 0px}\n                                .nav-tabs>li.active> a {background-color: rgb(106,66,137);  color:white;}\n                                .nav-tabs>li.active>a:focus {background-color: rgb(106,66,137);  color:white}\n                                .nav-tabs>li.active> a {background-color: rgb(106,66,137);  color:white}\n                                .nav-tabs>li.active>a:hover {background-color: rgb(106,66,137);  color:white}\n                                .nav-tabs {border-bottom: 1px solid rgb(106,66,137);}\n                                .irs-bar {background: rgb(106,66,137); border-top: 1px solid rgb(106,66,137); border-bottom: 1px rgb(106,66,137);}\n                                .irs-bar-edge {background: rgb(106,66,137); border: 1px solid rgb(106,66,137); height: 25px; border-radius: 0px; width: 20px;}\n                                .irs-to {background: rgb(106,66,137);}\n                                .irs-from {background: rgb(106,66,137);}\n                                table.dataTable > thead > tr {color: white; background-color:rgb(106,66,137); text-align: center;}\n                                table.dataTable > thead > tr > [class='dt-right dt-center sorting'] {text-align: center;}\n                                table.dataTable > thead > tr > [class='dt-right dt-center sorting_asc'] {text-align: center;}\n                                table.dataTable > thead > tr > [class='dt-right dt-center sorting_desc'] {text-align: center;}\n                                table.dataTable {line-height:1}\n                                Table {padding-top: 10px;}\n                                \"\n                )\n                ),\n                tags$head(tags$style(\n                  type=\"text/css\",\n                  \"#Infographic img, {width: 60%;\n                   display: block;\n                   margin-left: auto;\n                   margin-right: auto;}\")),\n                #Adding in titlePanel\n                titlePanel(div(HTML(\"<strong><font style = 'color: rgb(106, 66, 137)'>Radiotherapy Distance App</strong></font>\"),\n                               img(src=\"CILogo.jpg\", align =\"right\", height=55))),\n                #Main panel\n                mainPanel(width = 12,\n                    # Creating tabs for main panel\n                    column(width = 12),\n                    tabsetPanel(id = \"tabpanel\",\n                                position = \"centre\",\n                                type = \"tabs\",\n                                #Tab 1: Radiotherapy Distance Levels\n                                tabPanel(\"Infographic\",\n                                         br(),\n                                         #Plotting Radiotherapy Distance Levels\n                                         div(plotOutput(\"Infographic\"), align = \"center\"),\n                                         value = 1\n                                         ),\n                                #Tab 2: Radiotherapy Distance Proportions\n                                tabPanel(\"Graph\",\n                                         br(),\n                                         #Plotting Radiotherapy Distance Proportions\n                                         # plotOutput(\"RadiotherapyDistanceProportion\", height = 450),\n                                         value = 2\n                                ),\n                                #Tab 3: Map\n                                tabPanel(\"Map\",\n                                         #Plotting Radiotherapy Distance Map\n                                         # plotOutput(\"RadiotherapyDistanceMap\"),\n                                         value = 3)\n                    )\n                )\n)\n)\n\n\n##2. Shiny server\n#Setting up Shiny server\nserver <- function(input, output, session) {\n  \n  \n  #Plotting visualisations\n  #Tab 1: Radiotherapy Distance Levels\n  # Tab1: Infographic\n  output$Infographic = renderPlot({ggplot() +\n    annotation_custom(Rast1, ymin = 0, ymax = 20, xmin = 2009) +\n    coord_cartesian(xlim=c(2009,2018), ylim=c(4,20)) +\n    geom_line(data=Line, aes(x=Year, y=Spend), size=10, colour=\"red\") +\n    geom_polygon(data=Poly, aes(x=Year, y=Spend), fill=\"white\") + \n    labs(title=\"Drug prices soaring!\", subtitle=\"Infographic\",\n         x=\"Year\", y=\"Annual drug spend ($ million)\",\n         caption=\"Source: PBAC etc\")\n    }  , height = 800, width = 800)\n  \n  # \n\n  \n  # #Tab 2: Radiotherapy Distance Proportion\n  # output$RadiotherapyDistanceProportion <- renderPlot({ggplot() + \n  #     geom_bar(data = RadioTXDF4() %>%\n  #                filter(!is.na(RadioTXDF4()$ResidentLHDName)), \n  #              aes(x = ResidentLHDName, weight = Prop, fill = factor(DistanceExcess1Cat, levels=c(\"500km+\", \"251-500km\", \"101-250km\",  \"51-100km\",  \"11-50km\", \"Nearest\"), ordered = TRUE))) +\n  #     ggplot2:::manual_scale('fill', values = setNames(kBarCols,\n  #                                                      c(\"Nearest\", \"11-50km\",  \"51-100km\", \"101-250km\", \"251-500km\", \"500km+\"))) + coord_flip() + labs(fill=\"Distance\")  + ggtitle(paste0(\"Excess travel: \", input$CancerCode)) + \n  #     theme(plot.title = element_text(size=18)) + \n  #     scale_y_continuous(labels = scales::percent) +\n  #     theme(plot.title = element_text(size=18)) +\n  #     xlab(\"\") +\n  #     ylab(\"Percent\")\n  # })\n  # \n  # #Tab 3: Radiotherapy Distance Map\n  # output$RadiotherapyDistanceMap = renderPlot({ggplot() + \n  #     coord_fixed(xlim=c(XMin(),XMax()), ylim=c(YMin(), YMax())) +\n  #     geom_polygon(data=LHDPolygons, \n  #                  aes(x=Long, y=Lat, group=LHDSegment),\n  #                  colour = NA, fill=\"lightgrey\", size=0) +\n  #     geom_polygon(data=LHDXPolygon(), aes(x=Long, y=Lat, group=LHDSegment),\n  #                  colour = NA, fill=\"darkgrey\", size=0) +\n  #     geom_segment(data = RadioTXDF2(),\n  #                  aes(x = ResidentLong, y = ResidentLat, xend = TXFacilityLong, yend = TXFacilityLat, colour=DistanceExcess1Cat),\n  #                  alpha=0.5, size=1.25) +\n  #     geom_polygon(data=LHDXPolygon(), aes(x=Long, y=Lat, group=LHDSegment),\n  #                  colour = \"white\", fill=NA, size=0.5) +\n  #     geom_point(data=RadioFacilities,\n  #                aes(x=TXFacilityLong, y=TXFacilityLat), colour=\"red\", size=1) + \n  #     facet_wrap(. ~ DistanceExcess1Cat, ncol = 2) +\n  #     scale_color_manual(values = kBarCols, name = \"Excess Travel\") +\n  #     theme(strip.background =element_rect(fill=kBarCols)) +\n  #     theme(strip.text = element_text(colour = 'white', size = 12)) + \n  #     guides(colour=FALSE)\n  #   \n  # }) \n  }\n\n\n#Run App\nshinyApp(ui, server)\n\n",
    "created" : 1538717229421.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1723725046",
    "id" : "167A54CE",
    "lastKnownWriteTime" : 1538712442,
    "last_content_update" : 1538712442,
    "path" : "H:/Restricted Share/Metadata Repository Project/Projects/ThreeClickGraphicApp/ThreeClickGraphicApp.r",
    "project_path" : "ThreeClickGraphicApp.r",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}